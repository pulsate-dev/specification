# タイムライン

`main` ブランチの最新 API リファレンスは
[api.pulsate.dev/reference](https://api.pulsate.dev/reference) で閲覧可能.

## APIのバージョニング

APIの規定パス(Base Path)は `/api/v0` である.

APIのバージョンは以下の通り.

| バージョン | ステータス |
| ---------- | ---------- |
| v0         | 策定途中   |

## 資格情報が必要なエンドポイントの実行方法

Pulsate v0 APIでは殆どのエンドポイントで資格情報が必要である.

資格情報が必要なエンドポイントへアクセスするためには,
以下の方法でエンドポイントにアクセスする必要がある.

エンドポイントへアクセスするときの`Authorization` HTTPヘッダーに

```json
Bearer <token>
```

の形式で [認証トークン](./model.md#認証トークン) をつけて送信する必要がある.

例:

```json
Bearer
```

## “文字数”の扱い

特に明記しない限り、文字数は **以下のコードを実行して計算できる文字数** とする.

```tsx
const count = (s: string) => {
  const segmenter = new Intl.Segmenter({ granularity: "word" });
  return [...segmenter.segment(s)].length;
};
```

このAPIを実装する実行環境のリストはMDNを参照せよ.

[Intl.Segmenter - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter#ブラウザーの互換性)

## “時刻/時間”の扱い

特に明記しない限り、システム上の時刻の扱いは以下の通りである.

- 日時は例外なくタイムゾーンをUTCとして扱う
- 時刻のフォーマットは ISO 8601 とする.
  - `"yyyy-MM-DDTHH:mm:ss.SSSZ"`形式
  - タイムゾーン指定されていた場合は指定したタイムゾーンの日時をUTCに変換する.
    - 例:
      - `2023-11-21T09:00:00.000+09:00` : 日本時間(JST, UTC+9)
        2023年11月21日09:00:00.000 → `2023-11-21T00:00:00.000Z` :
        世界協定時(UTC) 2023年11月21日00:00:00.000
  - 以上の形式に合致しない形で日時の表現がされた場合はエラー終了するものとする.

## 絵文字の扱い

絵文字とは, Unicodeによって定義される絵文字とカスタム絵文字のことである.

その他の記号や環境依存文字は絵文字ではないとする.

### Unicode絵文字

Unicode絵文字とは,Unicodeによって定義される絵文字である.

APIとやり取りするテキストデータでは特殊な記法を用いずUnicodeで表現する.

例:

```json
{
  "content": "🎉"
}
```

### カスタム絵文字

カスタム絵文字を文字列内に埋め込むための形式は以下の通りである.

以下の形式に沿わない場合は単なる文字列であると解釈する.

- 全体を`<>` で囲む
  - カスタム絵文字のエイリアスは`::`で囲む
  - カスタム絵文字に関する詳細な定義はここでは行わない. (ToDo)
- エイリアスのあとに(絵文字があるインスタンスではなく,APIを提供するインスタンスでの)カスタム絵文字のIDを表記する.

例:

```md
<:alias:2949583895994> <:ii_hanashi:284745363>
```

## 特殊なテキスト埋め込みオブジェクト

投稿本文, CW注釈, アカウントbio のテキスト内にカスタム絵文字やメンションなど,
Unicodeで規定された文字以外のデータを表現するときの記法

カスタム絵文字は [カスタム絵文字](#カスタム絵文字) を参照せよ.

### メンション

表記法は以下の通り

- メンションは`<>`で囲む
- 囲んだ中にアカウント名を入れる
  - [RFC 7565で規定される形式](https://datatracker.ietf.org/doc/htmlrfc7565#:~:text=labels%0A%20%20%20%20%20%20%5BRFC5890%5D.-,7,-%20%20IANA%20Considerations%0A%0A%20%20%20In)
    のスキームである`acct:`を取り除き, `@`に置き換えたもの
  - 例: アカウント名が `@john@example.com`である場合

```json
<@john@example.com>
```

- 宛先のホスト名(FQDN)は **省略不可**

```md
<@john@example.com> <@la@mi.growthers.dev> <@gargon@mastodon.social>
```

### 基本エラーオブジェクト

APIにおいて何らかのエラーが発生した際には以下のようなエラーオブジェクトを返却する.

```json
{
  "error": "TEST_ERROR_CODE"
}
```

errorの中には`エラーコード` が入る.
エラーコードはエラーを返却するAPIのエンドポイントでどのようなコードを返すか指定するものとする.

エラーオブジェクトはエラーコードのみをメンバーとして含むオブジェクトである.

エラーコード以外の情報をエラーオブジェクトとして返却することは許容されない.

## NSFWフラグ

言葉の意味:

> **NSFW**とは、英語圏で用いられるインターネットスラングで、「職場では見ない方がいい」（職場での閲覧は危険）という意味の略語である。日本語の「閲覧注意」におおむね相当する。
>
> NSFWは画像がメインの掲示板や、掲示板中の画像へのリンクなどに付けて用いられやすい。たいていは卑猥（エロ画像）・残酷（グロ画像）といった要素の強い、不用意な閲覧ははばかられる類のコンテンツが掲載されている。

- NSFWフラグとは,画像/音声/動画の内容がNSFWであることを示すためのフラグである.
- 大抵の場合画像/音声/動画にぼかし(ブラー)がかけられたり,閲覧注意の文言が(システムのUI上で)表示される.

## ContentsWarning/CWフラグ

- CWフラグとは,投稿本文に何らかのコンテンツ警告があることを示すフラグである.
- 大抵の場合,投稿の注釈(投稿本文より短い,本文の内容を端的に表した文)のみが表示され,本文は[続きを読む]といったボタンを押さないと見ることができない

---

- リファレンスへの追加状況 (See:
  [pulsate-dev/specification#3](https://github.com/pulsate-dev/specification/issues/3)
  )
  - [ ] アカウント
    - [x] アカウント情報(プロフィール)を管理する
    - [x] アカウント情報の取得
    - [x] アカウントの削除
    - [ ] アカウントの検索
    - [x] アカウントのサイレンス
    - [x] アカウトのサイレンス解除
    - [x] アカウントの凍結
    - [x] アカウトの解凍
    - [x] ログイン
    - [x] アカウント登録
  - [x] フォロー
    - [x] アカウントをフォロー
    - [x] アカウントをフォロー解除
  - [x] ノート
    - [x] ノートの作成
    - [x] (自分の)ノートの削除
    - [x] リノートの作成
    - [x] リノートの解除(削除)
    - [x] ノートへのリアクションの作成
    - [x] ノートへのリアクションの解除
    - [x] ノートのブックマーク
    - [x] ノートの検索
    - [x] ノートの取得
  - [x] リスト
    - [x] リストの作成
    - [x] リストの削除
    - [x] リストへのアカウントの追加
    - [x] リストへのアカウントの除外/削除
    - [x] リストのノート取得
  - [x] ドライブ
    - [x] ファイルのアップロード
    - [x] ファイルの取得
    - [x] ノートへの紐付け
    - [x] NSFWフラグの設定
